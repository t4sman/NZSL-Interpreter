(()=>{"use strict";const e={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,ignoreEnter:!1,updateOnSelect:!1,highlightTyped:!1,highlightClass:"",fullWidth:!1,fixed:!1,fuzzy:!1,startsWith:!1,preventBrowserAutocomplete:!1,itemClass:"",activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",searchFields:["label"],queryParam:"query",items:[],source:null,hiddenInput:!1,hiddenValue:"",clearControl:"",datalist:"",server:"",serverMethod:"GET",serverParams:{},serverDataKey:"data",fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(e,t,s)=>t,onSelectItem:(e,t)=>{},onServerResponse:(e,t)=>e.json(),onChange:(e,t)=>{},onBeforeFetch:e=>{},onAfterFetch:e=>{}},t="is-loading",s="show",i="next",n="prev",o=new WeakMap;let r=0,a=0;function l(e){return e?function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}(e.toString()).toLowerCase():""}function h(e,t){if(e.indexOf(t)>=0)return!0;let s=0;for(let i=0;i<t.length;i++){const n=t[i];if(" "!=n&&(s=e.indexOf(n,s)+1,s<=0))return!1}return!0}function c(e,t){return e.parentNode.insertBefore(t,e.nextSibling)}function d(e,t){for(const[s,i]of Object.entries(t))e.setAttribute(s,i)}let u=!1;function p(){u||(class{constructor(e,t={}){if(!(e instanceof HTMLElement))return void console.error("Invalid element",e);o.set(e,this),r++,a++,this._searchInput=e,this._configure(t),this._preventInput=!1,this._keyboardNavigation=!1,this._searchFunc=function(e,t=300){let s;return(...i)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(this,i)}),t)}}((()=>{this._loadFromServer(!0)}),this._config.debounceTime),this._configureSearchInput(),this._configureDropElement(),this._config.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this));const s=this._getClearControl();s&&s.addEventListener("click",this),["focus","change","blur","input","keydown"].forEach((e=>{this._searchInput.addEventListener(e,this)})),["mousemove","mouseleave"].forEach((e=>{this._dropElement.addEventListener(e,this)})),this._fetchData()}static init(e="input.autocomplete",t={}){document.querySelectorAll(e).forEach((e=>{this.getOrCreateInstance(e,t)}))}static getInstance(e){return o.has(e)?o.get(e):null}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,t)}dispose(){a--,["focus","change","blur","input","keydown"].forEach((e=>{this._searchInput.removeEventListener(e,this)})),["mousemove","mouseleave"].forEach((e=>{this._dropElement.removeEventListener(e,this)}));const e=this._getClearControl();e&&e.removeEventListener("click",this),this._config.fixed&&a<=0&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this._dropElement.parentElement.removeChild(this._dropElement),o.delete(this._searchInput)}_getClearControl(){if(this._config.clearControl)return document.querySelector(this._config.clearControl)}handleEvent=e=>{["scroll","resize"].includes(e.type)?(this._timer&&window.cancelAnimationFrame(this._timer),this._timer=window.requestAnimationFrame((()=>{this[`on${e.type}`](e)}))):this[`on${e.type}`](e)};_configure(t={}){this._config=Object.assign({},e);const s={...t,...this._searchInput.dataset},i=e=>["true","false","1","0",!0,!1].includes(e)&&!!JSON.parse(e);for(const[t,n]of Object.entries(e)){if(void 0===s[t])continue;const e=s[t];switch(typeof n){case"number":this._config[t]=parseInt(e);break;case"boolean":this._config[t]=i(e);break;case"string":this._config[t]=e.toString();break;case"object":if(Array.isArray(n))if("string"==typeof e){const s=e.includes("|")?"|":",";this._config[t]=e.split(s)}else this._config[t]=e;else this._config[t]="string"==typeof e?JSON.parse(e):e;break;case"function":this._config[t]="string"==typeof e?window[e]:e;break;default:this._config[t]=e}}}_configureSearchInput(){if(this._searchInput.autocomplete="off",this._searchInput.spellcheck=!1,d(this._searchInput,{"aria-autocomplete":"list","aria-haspopup":"menu","aria-expanded":"false",role:"combobox"}),this._searchInput.id&&this._config.preventBrowserAutocomplete){const t=document.querySelector(`[for="${this._searchInput.id}"]`);t&&((e=t).ariaLabel=e.innerText,e.innerHTML=e.innerText.split("").map((e=>e+"&zwj;")).join(""))}var e;this._hiddenInput=null,this._config.hiddenInput&&(this._hiddenInput=document.createElement("input"),this._hiddenInput.type="hidden",this._hiddenInput.value=this._config.hiddenValue,this._hiddenInput.name=this._searchInput.name,this._searchInput.name="_"+this._searchInput.name,c(this._searchInput,this._hiddenInput))}_configureDropElement(){this._dropElement=document.createElement("ul"),this._dropElement.id="ac-menu-"+r,this._dropElement.classList.add("dropdown-menu","autocomplete-menu","p-0"),this._dropElement.style.maxHeight="280px",this._config.fullWidth||(this._dropElement.style.maxWidth="360px"),this._config.fixed&&(this._dropElement.style.position="fixed"),this._dropElement.style.overflowY="auto",this._dropElement.style.overscrollBehavior="contain",this._dropElement.style.textAlign="unset",c(this._searchInput,this._dropElement),this._searchInput.setAttribute("aria-controls",this._dropElement.id)}onclick(e){e.target.matches(this._config.clearControl)&&this.clear()}oninput(e){this._preventInput||(this._hiddenInput&&(this._hiddenInput.value=null),this.showOrSearch())}onchange(e){const t=this._searchInput.value,s=Object.values(this._items).find((e=>e.label===t));this._config.onChange(s,this)}onblur(e){this.hideSuggestions()}onfocus(e){this.showOrSearch()}onkeydown(e){switch(e.keyCode||e.key){case 13:case"Enter":if(this.isDropdownVisible()){const t=this.getSelection();t&&t.click(),!t&&this._config.ignoreEnter||e.preventDefault()}break;case 38:case"ArrowUp":e.preventDefault(),this._keyboardNavigation=!0,this._moveSelection(n);break;case 40:case"ArrowDown":e.preventDefault(),this._keyboardNavigation=!0,this.isDropdownVisible()?this._moveSelection(i):this.showOrSearch(!1);break;case 27:case"Escape":this.isDropdownVisible()&&(this._searchInput.focus(),this.hideSuggestions())}}onmousemove(e){this._keyboardNavigation=!1}onmouseleave(e){this.removeSelection()}onscroll(e){this._positionMenu()}onresize(e){this._positionMenu()}getConfig(e=null){return null!==e?this._config[e]:this._config}setConfig(e,t){this._config[e]=t}setData(e){this._items={},this._addItems(e),this._rawItems=e}enable(){this._searchInput.setAttribute("disabled","")}disable(){this._searchInput.removeAttribute("disabled")}isDisabled(){return this._searchInput.hasAttribute("disabled")||this._searchInput.disabled||this._searchInput.hasAttribute("readonly")}isDropdownVisible(){return this._dropElement.classList.contains(s)}clear(){this._searchInput.value="",this._hiddenInput&&(this._hiddenInput.value="")}getSelection(){return this._dropElement.querySelector("a.is-active")}removeSelection(){const e=this.getSelection();e&&e.classList.remove(...this._activeClasses())}_activeClasses(){return[...this._config.activeClasses,"is-active"]}_isItemEnabled(e){if("none"===e.style.display)return!1;const t=e.firstElementChild;return"A"===t.tagName&&!t.classList.contains("disabled")}_moveSelection(e=i,t=null){const s=this.getSelection();if(s){const o=e===i?"nextSibling":"previousSibling";t=s.parentNode;do{t=t[o]}while(t&&!this._isItemEnabled(t));t?(s.classList.remove(...this._activeClasses()),e===n?t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop:t.offsetTop>t.parentNode.offsetHeight-t.offsetHeight&&(t.parentNode.scrollTop+=t.offsetHeight)):s&&(t=s.parentElement)}else{if(e===n)return t;if(!t)for(t=this._dropElement.firstChild;t&&!this._isItemEnabled(t);)t=t.nextSibling}if(t){const e=t.querySelector("a");e.classList.add(...this._activeClasses()),this._searchInput.setAttribute("aria-activedescendant",e.id),this._config.updateOnSelect&&(this._searchInput.value=e.dataset.label)}else this._searchInput.setAttribute("aria-activedescendant","");return t}_shouldShow(){return!this.isDisabled()&&this._searchInput.value.length>=this._config.suggestionsThreshold}showOrSearch(e=!0){!e||this._shouldShow()?this._config.liveServer?this._searchFunc():this._config.source?this._config.source(this._searchInput.value,(e=>{this.setData(e),this._showSuggestions()})):this._showSuggestions():this.hideSuggestions()}_createGroup(e){const t=this._createLi(),s=document.createElement("span");return t.append(s),s.classList.add("dropdown-header","text-truncate"),s.innerHTML=e,t}_createItem(e,t){let s=t.label;if(this._config.highlightTyped){const t=l(s).indexOf(e);-1!==t&&(s=s.substring(0,t)+`<mark class="${this._config.highlightClass}">${s.substring(t,t+e.length)}</mark>`+s.substring(t+e.length,s.length))}s=this._config.onRenderItem(t,s,this);const i=this._createLi(),n=document.createElement("a");if(i.append(n),n.id=this._dropElement.id+"-"+this._dropElement.children.length,n.classList.add("dropdown-item","text-truncate"),this._config.itemClass&&n.classList.add(...this._config.itemClass.split(" ")),n.setAttribute("data-value",t.value),n.setAttribute("data-label",t.label),n.setAttribute("tabindex","-1"),n.setAttribute("role","menuitem"),n.setAttribute("href","#"),n.innerHTML=s,t.data)for(const[e,s]of Object.entries(t.data))n.dataset[e]=s;return n.addEventListener("mouseenter",(e=>{this._keyboardNavigation||(this.removeSelection(),i.querySelector("a").classList.add(...this._activeClasses()))})),n.addEventListener("mousedown",(e=>{e.preventDefault()})),n.addEventListener("click",(e=>{e.preventDefault(),this._preventInput=!0,this._hiddenInput&&(this._hiddenInput.value=t.value),this._config.onSelectItem(t,this),this.hideSuggestions(),this._preventInput=!1})),i}_search(e){const t=Object.keys(this._items);let s=0,i=null;const n=[];for(let o=0;o<t.length;o++){const r=t[o],a=this._items[r],c=this._config.showAllSuggestions||0===e.length;let d=0==e.length&&0===this._config.suggestionsThreshold;!c&&e.length>0&&this._config.searchFields.forEach((t=>{const s=l(a[t]);let i=!1;i=this._config.fuzzy?h(s,e):this._allWordsMatch(s,e),i&&(d=!0)}));const u=d||0===e.length;if(c||d){if(s++,a.group&&!n.includes(a.group)){const e=this._createGroup(a.group);this._dropElement.appendChild(e),n.push(a.group)}const t=this._createItem(e,a);if(!i&&u&&(i=t),this._dropElement.appendChild(t),this._config.maximumItems>0&&s>=this._config.maximumItems)break}}}_allWordsMatch(e,t){const s=t.split(/\s+/);for(const t of s)if(t.length>0&&-1===e.indexOf(t))return!1;return!0}_searchV2(e,t){if(0===t.length)return[];if(0===e.length)return[];const s=["menu","path","category","post","page","course","lesson","podcast","quiz","_"],i=this._config.maximumItems;let n={};s.forEach((e=>n[e]=[])),t.forEach((t=>{let i=l(t.title);if(this._allWordsMatch(i,e)){let e=s.includes(t.kind)?t.kind:"_";n[e].push(t)}}));let o=[],r={};for(;o.length<i;){for(let e of s)if(n[e]&&n[e].length>0){let t=n[e].shift();if(r[t.url])continue;if(o.push(t),r[t.url]=!0,o.length===i)break}if(Object.values(n).every((e=>0===e.length)))break}return o}_showSuggestions(){if(document.activeElement!=this._searchInput)return;const e=l(this._searchInput.value);this._dropElement.innerHTML="",this._searchV2(e,this._rawItems).forEach((t=>{const s=this._createItem(e,t);this._dropElement.appendChild(s)}));const t=this._createItem("",{label:"<strong>Show all results &amp; advanced filters →</strong>",url:`/search?q=${e}`,kind:"search"});t.classList.add("border-top"),t.classList.add("bg-light"),this._dropElement.appendChild(t),this._showDropdown()}_createLi(){const e=document.createElement("li");return e.setAttribute("role","presentation"),e}_showDropdown(){this._dropElement.classList.add(s),this._dropElement.setAttribute("role","menu"),d(this._searchInput,{"aria-expanded":"true"}),this._positionMenu()}toggleSuggestions(e=!0){this._dropElement.classList.contains(s)?this.hideSuggestions():this.showOrSearch(e)}hideSuggestions(){this._dropElement.classList.remove(s),d(this._searchInput,{"aria-expanded":"false"}),this.removeSelection()}getInput(){return this._searchInput}getDropMenu(){return this._dropElement}distanceFromElementToRightViewport(e){const t=e.getBoundingClientRect();return window.innerWidth-t.left}_positionMenu(){const e=window.getComputedStyle(this._searchInput),t=this._searchInput.getBoundingClientRect(),s="rtl"===e.direction,i=this._config.fullWidth;let n=null,o=null;if(this._config.fixed&&(n=t.x,o=t.y+t.height,s&&!i&&(n-=this._dropElement.offsetWidth-t.width)),this._dropElement.style.transform="unset",i){const e=this._searchInput.offsetWidth,t=this.distanceFromElementToRightViewport(this._searchInput)-10;let s=e;e<325&&(s=Math.min(t,400)),this._dropElement.style.width=s+"px"}null!==n&&(this._dropElement.style.left=n+"px"),null!==o&&(this._dropElement.style.top=o+"px");const r=this._dropElement.getBoundingClientRect(),a=window.innerHeight;if(r.y+r.height>a){const e=i?t.height+4:t.height;this._dropElement.style.transform="translateY(calc(-100.1% - "+e+"px))"}}_fetchData(){this._items={},this._addItems(this._config.items);const e=this._config.datalist;if(e){const t=document.querySelector(`#${e}`);if(t){const e=Array.from(t.children).map((e=>({value:e.getAttribute("value")??e.innerHTML.toLowerCase(),label:e.innerHTML})));this._addItems(e)}else console.error(`Datalist not found ${e}`)}this._setHiddenVal(),this._config.server&&!this._config.liveServer&&this._loadFromServer(this._shouldShow())}_setHiddenVal(){if(this._config.hiddenInput&&!this._config.hiddenValue)for(const[e,t]of Object.entries(this._items))t.label==this._searchInput.value&&(this._hiddenInput.value=e)}_addItems(e){const t=Object.keys(e);for(let s=0;s<t.length;s++){const i=t[s],n=e[i];if(n.group&&n.items){n.items.forEach((e=>e.group=n.group)),this._addItems(n.items);continue}const o="string"==typeof n?n:n.label,r="object"!=typeof n?{}:n;r.label=n[this._config.labelField]??o,r.value=n[this._config.valueField]??i,r.label&&(this._items[r.value]=r)}}_loadFromServer(e=!1){this._abortController&&this._abortController.abort(),this._abortController=new AbortController;let s=this._searchInput.dataset.serverParams||{};"string"==typeof s&&(s=JSON.parse(s));const i=Object.assign({},this._config.serverParams,s);if(i[this._config.queryParam]=this._searchInput.value,this._config.noCache&&(i.t=Date.now()),i.related){const e=document.getElementById(i.related);if(e){i.related=e.value;const t=e.getAttribute("name");t&&(i[t]=e.value)}}const n=new URLSearchParams(i);let o=this._config.server,r=Object.assign(this._config.fetchOptions,{method:this._config.serverMethod||"GET",signal:this._abortController.signal});"POST"===r.method&&(r.body=n),this._searchInput.classList.add(t),this._config.onBeforeFetch(this),fetch(o,r).then((e=>this._config.onServerResponse(e,this))).then((t=>{const s=t[this._config.serverDataKey]||t;this.setData(s),this._setHiddenVal(),this._abortController=null,e&&this._showSuggestions()})).catch((e=>{"AbortError"===e.name||this._abortController.signal.aborted||console.error(e)})).finally((e=>{this._searchInput.classList.remove(t),this._config.onAfterFetch(this)}))}}.init("input.search-autocomplete",{server:"/search/api/autocomplete/",serverDataKey:"results",noCache:!1,valueField:"url",labelField:"title",suggestionsThreshold:0,maximumItems:7,autoselectFirst:!1,ignoreEnter:!0,fullWidth:!0,fuzzy:!1,searchFields:["title"],highlightTyped:!0,highlightClass:"autocomplete-highlight",activeClasses:["bg-primary","text-white"],itemClass:"small",onRenderItem:(e,t)=>{let s;switch(e.kind){case"post":case"page":s="solid/file-lines";break;case"course":case"lesson":s="@play";break;case"path":s="@learning-path";break;case"podcast":s="@podcast";break;case"team_member":s="solid/user";break;case"category":s="@category";break;case"search":s="@search";break;case"quiz":s="@quiz";break;case"menu":s="@menu-command";break;default:s="solid/link"}return function(e,t={}){const s=JSON.parse(document.getElementById("icons-data").textContent).iconsUrl,i=e.split("/").join("--"),n=t.scale;let o="";if(n){if(!["2x","3x","4x","5x"].includes(n))throw new Error(`Invalid icon scale factor: ${n}`);o=`scale${n}`}return`<span class="${["icon",void 0===t.baseline||t.baseline?"baseline":"",o,t.class||""].filter(Boolean).join(" ")}"><svg><use href="${s}#${i}"/></svg></span>`}(s,{class:"mr-1"})+t},onSelectItem:e=>{window.location.href=e.url}}),u=!0)}var m;m=()=>{document.querySelectorAll("input.search-autocomplete").forEach((e=>{const t=function(){p(),e.removeEventListener("focus",t)};e.addEventListener("focus",t),e.addEventListener("keydown",(t=>{"Escape"===t.key&&e.blur()}))})),document.querySelectorAll(".search-hotkey-indicator").forEach((e=>{const t=e.previousElementSibling;t.addEventListener("focus",(()=>{e.classList.add("d-none")})),t.addEventListener("blur",(()=>{e.classList.remove("d-none")}))})),document.addEventListener("keydown",(function(e){"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable||"/"!==e.key&&("j"!==e.key&&"J"!==e.key||!e.metaKey&&!e.ctrlKey||e.metaKey&&e.ctrlKey)||(e.preventDefault(),document.querySelector('input[type="search"]').focus())}))},"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?m():document.addEventListener("DOMContentLoaded",m)})();